#!/usr/bin/env ruby

system "gem install aws-sdk-sns"

# Usage: ruby fake_product_update_event STACK_NAME
# This script is intended to mock the publishing of a product update event.

require 'aws-sdk-sns'
require 'json'

sns = Aws::SNS::Client.new(region: 'eu-west-1')

topic_arn = "arn:aws:sns:eu-west-1:235649422648:product-api-tue-ProductUpdateTopic-140YWHCOJ6OD8"

subject = 'Product Updated Notification'
num = rand(10000)
message = {
		    id: "#{num}",
		    price: num,
		    name: "Product #{num}"
		  }.to_json

begin
  sns.publish(topic_arn: topic_arn, subject: subject, message: message)
  puts "Published to SNS - Product #{num}"
rescue  => e
  puts 'Unable to publish notification'
  puts e.message
end